<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="SUMAQ - Reporta incidentes con foto y ubicaciÃ³n">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SUMAQ">

    <title>SUMAQ - Reportes</title>

    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/styles.css">
    <link rel="icon" type="image/png" href="/icon-192.png">
    <link rel="apple-touch-icon" href="/icon-192.png">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>ğŸ“ SUMAQ</h1>
            <p class="subtitle">Reporta incidentes</p>
        </header>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Vista Home -->
            <section class="view" id="viewHome">
                <div class="welcome-section">
                    <div class="welcome-icon">ğŸ›¡ï¸</div>
                    <h2>Bienvenido</h2>
                    <p>Ayuda a tu comunidad reportando incidentes</p>
                </div>

                <div class="action-buttons">
                    <button type="button" id="btnStartReport" class="btn-primary-large">
                        ğŸ“ Generar Reporte
                    </button>
                    <button type="button" id="btnLogin" class="btn-secondary-large">
                        ğŸ” Iniciar SesiÃ³n
                    </button>
                </div>
            </section>

            <!-- Vista 1: Foto -->
            <section class="view" id="viewPhoto" style="display: none;">
                <div class="step-indicator">Paso 1 de 4</div>
                <h2>Toma una foto</h2>
                <p class="step-description">Captura una imagen del incidente</p>

                <div class="photo-capture">
                    <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;">

                    <div id="photoPreviewContainer" style="display: none;">
                        <img id="previewImage" src="" alt="Preview" class="photo-preview-large">
                        <button type="button" id="btnRetakePhoto" class="btn-retake">
                            ğŸ”„ Tomar otra foto
                        </button>
                    </div>

                    <button type="button" id="btnTakePhoto" class="btn-camera-large">
                        ğŸ“· Tomar Foto
                    </button>
                </div>

                <div class="navigation-buttons">
                    <button type="button" id="btnCancelPhoto" class="btn-cancel">
                        âœ• Cancelar
                    </button>
                    <button type="button" id="btnNextPhoto" class="btn-next" disabled>
                        Siguiente â†’
                    </button>
                </div>
            </section>

            <!-- Vista 2: DescripciÃ³n -->
            <section class="view" id="viewDescription" style="display: none;">
                <div class="step-indicator">Paso 2 de 4</div>
                <h2>Describe el incidente</h2>
                <p class="step-description">Proporciona detalles sobre lo que sucediÃ³</p>

                <div class="form-field">
                    <textarea
                        id="description"
                        rows="6"
                        placeholder="Describe el incidente con el mayor detalle posible..."
                        maxlength="500"
                    ></textarea>
                    <div class="char-counter">
                        <span id="charCount">0</span>/500
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button type="button" id="btnBackDescription" class="btn-back">
                        â† AtrÃ¡s
                    </button>
                    <button type="button" id="btnNextDescription" class="btn-next" disabled>
                        Siguiente â†’
                    </button>
                </div>
            </section>

            <!-- Vista 3: UbicaciÃ³n -->
            <section class="view" id="viewLocation" style="display: none;">
                <div class="step-indicator">Paso 3 de 4</div>
                <h2>UbicaciÃ³n del incidente</h2>
                <p class="step-description">Marca dÃ³nde ocurriÃ³ el incidente</p>

                <div class="location-methods">
                    <button type="button" id="btnAutoLocation" class="btn-location-method active">
                        ğŸ“ GPS AutomÃ¡tico
                    </button>
                    <button type="button" id="btnMapLocation" class="btn-location-method">
                        ğŸ—ºï¸ Seleccionar en Mapa
                    </button>
                </div>

                <!-- GPS AutomÃ¡tico -->
                <div id="autoLocationContainer" class="location-container">
                    <button type="button" id="btnGetLocation" class="btn-get-location">
                        ğŸ“ Obtener mi ubicaciÃ³n
                    </button>
                    <div id="locationStatus" class="location-status"></div>
                </div>

                <!-- Mapa -->
                <div id="mapLocationContainer" class="location-container" style="display: none;">
                    <div class="map-instructions">
                        Haz clic en el mapa para marcar la ubicaciÃ³n exacta
                    </div>
                    <div id="map" class="location-map"></div>
                    <div id="mapStatus" class="location-status"></div>
                </div>

                <div class="navigation-buttons">
                    <button type="button" id="btnBackLocation" class="btn-back">
                        â† AtrÃ¡s
                    </button>
                    <button type="button" id="btnNextLocation" class="btn-next" disabled>
                        Siguiente â†’
                    </button>
                </div>
            </section>

            <!-- Vista 4: ConfirmaciÃ³n -->
            <section class="view" id="viewConfirm" style="display: none;">
                <div class="step-indicator">Paso 4 de 4</div>
                <h2>Confirma tu reporte</h2>
                <p class="step-description">Revisa la informaciÃ³n antes de enviar</p>

                <div class="summary-card">
                    <div class="summary-section">
                        <h3>ğŸ“· Foto</h3>
                        <img id="confirmPhoto" src="" alt="Foto del reporte" class="summary-photo">
                    </div>

                    <div class="summary-section">
                        <h3>ğŸ“ DescripciÃ³n</h3>
                        <p id="confirmDescription" class="summary-text"></p>
                    </div>

                    <div class="summary-section">
                        <h3>ğŸ“ UbicaciÃ³n</h3>
                        <p id="confirmLocation" class="summary-text"></p>
                    </div>
                </div>

                <div id="loadingIndicator" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Enviando reporte...</p>
                </div>

                <div class="navigation-buttons">
                    <button type="button" id="btnBackConfirm" class="btn-back">
                        â† AtrÃ¡s
                    </button>
                    <button type="button" id="btnSubmit" class="btn-submit-large">
                        âœ“ Enviar Reporte
                    </button>
                </div>
            </section>

            <!-- Vista 5: Ã‰xito -->
            <section class="view" id="viewSuccess" style="display: none;">
                <div class="success-icon">âœ“</div>
                <h2>Â¡Reporte enviado!</h2>
                <p class="success-message">Tu reporte ha sido registrado exitosamente. Gracias por ayudar a tu comunidad.</p>

                <div class="success-actions">
                    <button type="button" id="btnNewReport" class="btn-primary-large">
                        ğŸ“ Crear otro reporte
                    </button>
                    <button type="button" id="btnGoHome" class="btn-secondary">
                        ğŸ  Volver al inicio
                    </button>
                </div>
            </section>

        </main>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle">Confirmar acciÃ³n</h3>
            </div>
            <div class="modal-body">
                <p id="modalMessage">Â¿EstÃ¡s seguro?</p>
            </div>
            <div class="modal-footer">
                <button type="button" id="modalCancel" class="btn-modal-cancel">
                    Cancelar
                </button>
                <button type="button" id="modalConfirm" class="btn-modal-confirm">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Install Prompt (for PWA) -->
    <div id="installPrompt" class="install-prompt" style="display: none;">
        <div class="install-content">
            <p>ğŸ“± Instala SUMAQ en tu dispositivo</p>
            <button id="installBtn" class="btn-install">Instalar</button>
            <button id="dismissInstall" class="btn-dismiss">Ahora no</button>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <script src="/app.js"></script>
</body>
</html>
